---
- name: Clear OPAM directory
  file:
    path: "{{ app_base }}/.opam"
    state: absent

- name: Get the DPKG Architecture
  command: >-
    dpkg --print-architecture
  register: dpkg_arch
  changed_when: false

- name: Install Liquidsoap
  apt:
    deb: "https://github.com/savonet/liquidsoap/releases/download/v2.0.2/liquidsoap_2.0.2-ubuntu-focal-1_{{ dpkg_arch.stdout_lines[0] | default('amd64') }}.deb"

- name: Link Liquidsoap binary
  file:
    src: "/usr/bin/liquidsoap"
    dest: /usr/local/bin/liquidsoap
    state: link
    force: true
